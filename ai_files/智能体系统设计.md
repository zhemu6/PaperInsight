# PaperInsight 智能体系统设计

> **文档目的**: 设计 PaperInsight 系统中的智能体架构  
> **文档时间**: 2026-01-25  
> **基于**: AgentScope Java 框架

---

## 📋 目录

1. [智能体系统概述](#智能体系统概述)
2. [核心智能体设计](#核心智能体设计)
3. [辅助智能体设计](#辅助智能体设计)
4. [工具系统设计](#工具系统设计)
5. [智能体协作流程](#智能体协作流程)
6. [智能体配置管理](#智能体配置管理)
7. [性能与成本优化](#性能与成本优化)

---

## 智能体系统概述

### 设计原则

1. **单一职责**: 每个智能体专注于一个特定任务
2. **可扩展性**: 易于添加新的智能体
3. **可配置性**: 智能体参数可配置
4. **可观测性**: 支持日志和监控
5. **容错性**: 单个智能体失败不影响整体流程

### 系统架构

```
论文上传
    ↓
PDF 文本提取（工具）
    ↓
┌─────────────────────────────────────┐
│        智能体分析系统                  │
├─────────────────────────────────────┤
│ 1. 摘要智能体 (SummaryAgent)         │
│ 2. 创新点智能体 (InnovationAgent)    │
│ 3. 方法论智能体 (MethodologyAgent)   │
│ 4. 评分智能体 (ScoreAgent)           │
│ 5. 关键词提取智能体 (KeywordAgent)   │
│ 6. 相关论文推荐智能体 (RecommendAgent)│
│ 7. 论文对话智能体 (ChatAgent)        │
└─────────────────────────────────────┘
    ↓
结果聚合与保存
```

---

## 核心智能体设计

### 1. SummaryAgent (摘要智能体)

**职责**: 生成结构化的论文摘要

**输入**:
- 论文全文文本
- 可选：论文标题、作者信息

**输出**:
- Markdown 格式的结构化摘要
- 包含：研究背景、研究目标、主要方法、关键结果、结论

**系统提示词设计**:
```
你是一个专业的学术论文摘要生成助手。

请仔细阅读论文内容，生成结构化的Markdown格式摘要。

摘要应包含以下部分：
1. **研究背景**: 论文的研究背景和动机
2. **研究目标**: 论文要解决的核心问题
3. **主要方法**: 采用的研究方法和技术路线
4. **关键结果**: 主要的研究发现和实验结果
5. **结论**: 研究结论和未来工作

要求：
- 使用Markdown格式
- 语言简洁准确
- 突出论文的核心贡献
- 长度控制在500-1000字
```

**配置参数**:
- 模型: `qwen-plus` (平衡性能和成本)
- 最大迭代次数: 5
- 温度: 0.3 (保证稳定性)

**输出示例**:
```markdown
## 研究背景
本文针对XXX问题，在XXX领域进行了深入研究...

## 研究目标
本文旨在解决XXX问题，提出XXX方法...

## 主要方法
本文采用XXX方法，主要包括以下步骤：
1. XXX
2. XXX
3. XXX

## 关键结果
实验结果表明：
- XXX指标达到XXX
- XXX性能提升XXX%

## 结论
本文提出了XXX方法，在XXX方面取得了显著进展...
```

---

### 2. InnovationAgent (创新点智能体)

**职责**: 提取论文的核心贡献和创新点

**输入**:
- 论文全文文本
- 可选：摘要智能体的输出

**输出**:
- 核心贡献（Core Contribution）描述
- 创新点列表（每个创新点一行）

**系统提示词设计**:
```
你是一个专业的论文创新点提取助手。

请仔细分析论文，识别以下内容：
1. **核心贡献（Core Contribution）**: 论文最重要的贡献，用1-2句话概括
2. **创新点（Innovation Points）**: 论文的具体创新点，每个创新点用一句话描述

要求：
- 核心贡献要突出论文的独特价值
- 创新点要具体、可量化
- 按重要性排序
- 数量控制在3-7个
- 使用中文，语言专业准确
```

**配置参数**:
- 模型: `qwen-plus`
- 最大迭代次数: 5
- 温度: 0.4

**输出格式**:
```
核心贡献：
本文提出了XXX方法，在XXX方面取得了突破性进展。

创新点：
1. 提出了XXX算法，相比现有方法性能提升XX%
2. 设计了XXX架构，解决了XXX问题
3. 引入了XXX机制，提高了XXX效率
4. 验证了XXX假设，为XXX领域提供了新思路
```

---

### 3. MethodologyAgent (方法论智能体)

**职责**: 分析论文的研究方法和技术路线

**输入**:
- 论文全文文本
- 可选：摘要智能体的输出

**输出**:
- 研究方法描述
- 技术路线拆解
- 实验设计分析

**系统提示词设计**:
```
你是一个专业的研究方法论分析助手。

请分析论文的研究方法，包括：
1. **研究方法**: 论文采用的主要研究方法（如实验法、理论分析、仿真等）
2. **技术路线**: 研究的技术路线和步骤
3. **实验设计**: 实验设置、数据集、评估指标等
4. **方法论特点**: 方法论的创新之处或独特之处

要求：
- 结构清晰，层次分明
- 突出方法论的关键步骤
- 说明实验设计的合理性
- 使用专业术语，保持准确性
```

**配置参数**:
- 模型: `qwen-plus`
- 最大迭代次数: 6
- 温度: 0.3

**输出格式**:
```
## 研究方法
本文采用XXX方法进行研究，主要包括：
- 理论分析：XXX
- 实验验证：XXX
- 对比分析：XXX

## 技术路线
1. 问题定义：XXX
2. 方法设计：XXX
3. 实验实施：XXX
4. 结果分析：XXX

## 实验设计
- 数据集：XXX
- 评估指标：XXX
- 实验设置：XXX

## 方法论特点
本文的方法论在XXX方面具有创新性...
```

---

### 4. ScoreAgent (评分智能体)

**职责**: 对论文质量进行多维度评分

**输入**:
- 论文全文文本
- 可选：其他智能体的分析结果（摘要、创新点、方法论）

**输出**:
- 综合评分（0-100）
- 各维度评分
- 评分理由

**系统提示词设计**:
```
你是一个专业的论文质量评分助手。

请从以下维度对论文进行评分（每个维度0-100分）：

1. **创新性（Innovation）** (30分)
   - 研究问题的创新性
   - 方法的创新性
   - 结果的创新性

2. **技术性（Technical）** (30分)
   - 技术深度
   - 方法严谨性
   - 实验设计合理性

3. **实用性（Practicality）** (20分)
   - 实际应用价值
   - 可复现性
   - 推广潜力

4. **写作质量（Writing）** (20分)
   - 逻辑清晰度
   - 表达准确性
   - 结构完整性

请返回JSON格式：
{
  "score": 85,
  "dimensions": {
    "innovation": 28,
    "technical": 27,
    "practicality": 18,
    "writing": 12
  },
  "reasoning": "评分理由的详细说明..."
}
```

**配置参数**:
- 模型: `qwen-max` (需要更强的推理能力)
- 最大迭代次数: 8
- 温度: 0.2 (保证评分一致性)
- 结构化输出: 启用

**输出结构**:
```json
{
  "score": 85,
  "dimensions": {
    "innovation": 28,
    "technical": 27,
    "practicality": 18,
    "writing": 12
  },
  "reasoning": "该论文在创新性方面表现突出，提出了XXX方法...技术实现严谨，实验设计合理...但在写作质量方面有待提升..."
}
```

---

## 辅助智能体设计

### 5. ChatAgent (论文对话智能体) ⭐ 新增

**职责**: 基于论文内容与用户进行智能对话，回答论文相关问题

**输入**:
- 用户问题
- 论文全文文本（或摘要）
- 论文分析结果（摘要、创新点、方法论等）
- 对话历史（可选）

**输出**:
- 针对论文内容的回答
- Markdown 格式支持

**系统提示词设计**:
```
你是一个专业的学术论文对话助手，专门帮助用户深入理解论文内容。

你的核心能力：
1. **论文内容理解**: 基于论文全文和分析结果，准确理解论文内容
2. **智能问答**: 回答用户关于论文的各种问题
3. **深度解析**: 对论文的特定部分进行深入解析
4. **关联分析**: 帮助用户理解论文各部分之间的关联

你可以回答的问题类型：
- 论文的核心贡献是什么？
- 论文使用了什么方法？
- 实验是如何设计的？
- 论文的创新点在哪里？
- 论文的局限性是什么？
- 如何理解论文中的某个概念？
- 论文与其他研究的关系？
- 论文的实际应用价值？

工作流程：
1. 理解用户问题
2. 从论文内容和分析结果中检索相关信息
3. 结合上下文给出准确、专业的回答
4. 如果信息不足，诚实告知并引导用户

重要约束：
- 只基于论文内容回答，不要编造信息
- 如果论文中没有相关信息，明确告知
- 保持专业和准确
- 使用中文回答
- 可以引用论文的具体内容（如"论文中提到..."）
- 支持 Markdown 格式，便于展示代码、公式等
```

**配置参数**:
- 模型: `qwen-plus` 或 `qwen-max`（需要较强的理解能力）
- 最大迭代次数: 10（对话可能需要多轮推理）
- 温度: 0.4（平衡创造性和准确性）
- 内存: `AutoContextMemory`（自动压缩历史对话）

**工具支持**:
- `get_paper_content`: 获取论文全文内容
- `get_paper_analysis`: 获取论文分析结果（摘要、创新点等）
- `search_paper_section`: 搜索论文特定章节
- `get_related_papers`: 获取相关论文（用于对比）

**使用场景**:
- 论文详情页的"智能问答"功能
- 用户阅读论文时的实时问答
- 深入理解论文的特定部分
- 论文对比和关联分析

**对话管理**:
- 每个论文一个对话会话（sessionId = `paper_{paperId}_{userId}`）
- 使用 MySQL 会话持久化（参考官方示例）
- 支持多轮对话，保持上下文
- 对话历史可查看和导出

**优先级**: P1（重要功能，提升用户体验）

---

### 6. KeywordAgent (关键词提取智能体)

**职责**: 从论文中提取和优化关键词

**输入**:
- 论文全文文本
- 可选：论文标题、摘要

**输出**:
- 关键词列表（5-10个）
- 关键词分类（方法类、应用类、理论类等）

**系统提示词设计**:
```
你是一个专业的关键词提取助手。

请从论文中提取5-10个关键词，要求：
1. 准确反映论文的核心内容
2. 包含方法、应用、理论等多个维度
3. 使用标准术语
4. 按重要性排序

返回格式：
关键词1, 关键词2, 关键词3, ...
```

**配置参数**:
- 模型: `qwen-turbo` (简单任务，使用快速模型)
- 最大迭代次数: 3
- 温度: 0.3

**使用场景**:
- 论文上传时自动提取关键词
- 补充或优化用户手动输入的关键词

---

### 7. RecommendAgent (相关论文推荐智能体)

**职责**: 基于论文内容推荐相关论文

**输入**:
- 当前论文的分析结果（摘要、关键词、创新点）
- 可选：用户阅读历史

**输出**:
- 相关论文列表（3-5篇）
- 推荐理由

**系统提示词设计**:
```
你是一个专业的论文推荐助手。

基于以下论文信息，推荐3-5篇相关论文：
- 摘要：XXX
- 关键词：XXX
- 创新点：XXX

推荐标准：
1. 研究主题相关
2. 方法相关
3. 应用领域相关
4. 时间相关性（优先推荐近期论文）

返回格式：
1. 论文标题 - 推荐理由
2. 论文标题 - 推荐理由
...
```

**配置参数**:
- 模型: `qwen-plus`
- 最大迭代次数: 5
- 温度: 0.5 (需要一定的多样性)

**使用场景**:
- 论文详情页显示"相关论文"
- 首页"为你推荐"
- 基于阅读历史的个性化推荐

**注意**: 这个智能体需要结合数据库查询，先通过关键词/标题搜索候选论文，然后由智能体筛选和排序。

---

### 8. ComparisonAgent (论文对比智能体) - 可选

**职责**: 对比多篇论文的异同

**输入**:
- 多篇论文的分析结果

**输出**:
- 对比分析报告
- 异同点总结

**系统提示词设计**:
```
你是一个专业的论文对比分析助手。

请对比以下论文：
1. 论文A：XXX
2. 论文B：XXX

请分析：
1. 研究主题的异同
2. 方法的异同
3. 结果的异同
4. 优劣势对比

返回结构化的对比报告。
```

**配置参数**:
- 模型: `qwen-max`
- 最大迭代次数: 8
- 温度: 0.3

**使用场景**:
- 用户选择多篇论文进行对比
- 生成对比报告

**优先级**: P2（增强功能，非核心）

---

## 工具系统设计

### 1. PdfExtractionTool (PDF提取工具)

**职责**: 从PDF文件中提取文本内容

**实现方式**:
- 使用 Apache PDFBox 或 iText
- 支持多页文档
- 处理特殊格式（表格、公式等）

**接口**:
```java
@ToolFunction(name = "extract_pdf_text", 
              description = "从PDF文件中提取文本内容")
public String extractPdfText(
    @Tool.Param(name = "pdf_url", description = "PDF文件URL") String pdfUrl
)
```

**特性**:
- 错误处理（文件不存在、格式错误等）
- 文本清理（去除多余空白、格式化）
- 支持大文件（分页处理）

---

### 2. TextPreprocessingTool (文本预处理工具)

**职责**: 对提取的文本进行预处理

**功能**:
- 去除页眉页脚
- 识别和提取摘要部分
- 识别章节结构
- 清理格式

**接口**:
```java
@ToolFunction(name = "preprocess_text", 
              description = "预处理论文文本")
public String preprocessText(
    @Tool.Param(name = "raw_text", description = "原始文本") String rawText
)
```

---

### 3. PaperContentTool (论文内容工具) - 对话智能体专用

**职责**: 为对话智能体提供论文内容访问能力

**功能**:
- 获取论文全文内容
- 获取论文分析结果
- 搜索论文特定章节
- 获取论文元数据

**接口**:
```java
@Tool(name = "get_paper_content", 
      description = "获取论文全文内容")
public String getPaperContent(
    @ToolParam(name = "paper_id", description = "论文ID") Long paperId
)

@Tool(name = "get_paper_analysis", 
      description = "获取论文分析结果（摘要、创新点、方法论、评分）")
public String getPaperAnalysis(
    @ToolParam(name = "paper_id", description = "论文ID") Long paperId
)

@Tool(name = "search_paper_section", 
      description = "在论文中搜索特定章节或关键词")
public String searchPaperSection(
    @ToolParam(name = "paper_id", description = "论文ID") Long paperId,
    @ToolParam(name = "keyword", description = "搜索关键词") String keyword
)
```

**使用场景**:
- ChatAgent 需要访问论文内容时
- 支持精确引用论文内容

---

### 4. DatabaseQueryTool (数据库查询工具) - 可选

**职责**: 查询相关论文信息

**功能**:
- 根据关键词搜索论文
- 根据作者搜索论文
- 根据领域搜索论文

**接口**:
```java
@ToolFunction(name = "search_papers", 
              description = "搜索相关论文")
public List<PaperInfo> searchPapers(
    @Tool.Param(name = "keywords", description = "关键词") String keywords,
    @Tool.Param(name = "limit", description = "返回数量") Integer limit
)
```

**使用场景**:
- RecommendAgent 需要查询候选论文
- ChatAgent 需要查找相关论文时

---

## 智能体协作流程

### 标准分析流程

```
1. 用户上传论文
   ↓
2. PDF 上传到 COS，保存论文基本信息
   ↓
3. 发送分析任务到 RabbitMQ
   ↓
4. 消费者处理：
   a. 从 COS 下载 PDF
   b. 调用 PdfExtractionTool 提取文本
   c. 调用 TextPreprocessingTool 预处理文本
   ↓
5. 并行调用核心智能体：
   - SummaryAgent (摘要)
   - InnovationAgent (创新点)
   - MethodologyAgent (方法论)
   - ScoreAgent (评分)
   ↓
6. 可选：调用 KeywordAgent 提取/优化关键词
   ↓
7. 聚合所有结果，保存到 PaperInsight 表
   ↓
8. 通知用户（WebSocket 或轮询）
```

### 推荐流程

```
1. 用户查看论文详情
   ↓
2. 触发 RecommendAgent
   ↓
3. RecommendAgent 使用 DatabaseQueryTool 查询候选论文
   ↓
4. RecommendAgent 分析并筛选
   ↓
5. 返回推荐列表
```

### 对话流程

```
1. 用户在论文详情页发起对话
   ↓
2. 创建/加载对话会话（sessionId = paper_{paperId}_{userId}）
   ↓
3. ChatAgent 加载论文内容和分析结果
   ↓
4. 用户提问
   ↓
5. ChatAgent 使用工具获取相关信息
   - get_paper_content: 获取论文全文
   - get_paper_analysis: 获取分析结果
   - search_paper_section: 搜索特定内容
   ↓
6. ChatAgent 基于论文内容回答
   ↓
7. 保存对话历史
   ↓
8. 返回回答（支持流式输出）
```

### 对比流程（可选）

```
1. 用户选择多篇论文
   ↓
2. 获取这些论文的分析结果
   ↓
3. 调用 ComparisonAgent
   ↓
4. 生成对比报告
```

---

## 智能体配置管理

### 配置类设计

```java
@Configuration
@ConfigurationProperties(prefix = "agent")
public class AgentConfig {
    
    // DashScope 配置
    private DashScopeConfig dashscope;
    
    // 智能体配置
    private Map<String, AgentProperties> agents;
    
    // 工具配置
    private ToolConfig tools;
    
    @Data
    public static class DashScopeConfig {
        private String apiKey;
        private String modelName = "qwen-plus";
        private String baseUrl;
        private Boolean stream = false;
    }
    
    @Data
    public static class AgentProperties {
        private String modelName;  // 覆盖全局模型
        private Integer maxIterations = 5;
        private Double temperature = 0.3;
        private String sysPrompt;
        private Boolean enabled = true;  // 是否启用
    }
    
    @Data
    public static class ToolConfig {
        private Integer pdfMaxSize = 50 * 1024 * 1024;  // 50MB
        private Integer textMaxLength = 1000000;  // 100万字符
    }
}
```

### 配置文件示例

```yaml
agent:
  dashscope:
    api-key: ${DASHSCOPE_API_KEY:}
    model-name: qwen-plus
    base-url: https://dashscope.aliyuncs.com/api/v1
    stream: false
  
  agents:
    summary:
      model-name: qwen-plus
      max-iterations: 5
      temperature: 0.3
      enabled: true
      sys-prompt: |
        你是一个专业的学术论文摘要生成助手...
    
    innovation:
      model-name: qwen-plus
      max-iterations: 5
      temperature: 0.4
      enabled: true
    
    methodology:
      model-name: qwen-plus
      max-iterations: 6
      temperature: 0.3
      enabled: true
    
    score:
      model-name: qwen-max  # 使用更强的模型
      max-iterations: 8
      temperature: 0.2
      enabled: true
    
    keyword:
      model-name: qwen-turbo  # 使用快速模型
      max-iterations: 3
      temperature: 0.3
      enabled: true
    
    chat:
      model-name: qwen-plus  # 或 qwen-max（需要较强理解能力）
      max-iterations: 10  # 对话可能需要多轮推理
      temperature: 0.4  # 平衡创造性和准确性
      enabled: true
      sys-prompt: |
        你是一个专业的学术论文对话助手...
    
    recommend:
      model-name: qwen-plus
      max-iterations: 5
      temperature: 0.5
      enabled: true
  
  tools:
    pdf-max-size: 52428800  # 50MB
    text-max-length: 1000000
```

---

## 性能与成本优化

### 模型选择策略

| 智能体 | 推荐模型 | 原因 |
|--------|---------|------|
| SummaryAgent | qwen-plus | 平衡性能和成本 |
| InnovationAgent | qwen-plus | 平衡性能和成本 |
| MethodologyAgent | qwen-plus | 平衡性能和成本 |
| ScoreAgent | qwen-max | 需要更强的推理能力 |
| ChatAgent | qwen-plus 或 qwen-max | 需要较强理解能力，根据需求选择 |
| KeywordAgent | qwen-turbo | 简单任务，快速响应 |
| RecommendAgent | qwen-plus | 平衡性能和成本 |

### 并行处理

- 核心智能体（摘要、创新点、方法论、评分）**并行执行**
- 使用 `Mono.zip()` 等待所有结果
- 设置合理的超时时间（5-10分钟）

### 缓存策略

- 相同论文的分析结果可以缓存
- 使用 Redis 缓存分析结果
- 缓存键：`paper:analysis:{paperId}`

### 成本控制

1. **模型选择**: 根据任务复杂度选择模型
2. **迭代限制**: 设置合理的 `maxIterations`
3. **文本长度**: 对于超长论文，可以分段处理
4. **失败重试**: 限制重试次数，避免无限重试
5. **监控告警**: 设置API调用量告警

### 性能优化

1. **异步处理**: 使用 RabbitMQ 异步处理
2. **批量处理**: 支持批量分析（未来）
3. **流式输出**: 对于长文本，考虑流式输出
4. **连接池**: 复用模型连接

---

## 智能体注册表

### 核心智能体（必须）

| 智能体 | 优先级 | 状态 | 备注 |
|--------|--------|------|------|
| SummaryAgent | P0 | 待开发 | 核心功能 |
| InnovationAgent | P0 | 待开发 | 核心功能 |
| MethodologyAgent | P0 | 待开发 | 核心功能 |
| ScoreAgent | P0 | 待开发 | 核心功能 |

### 辅助智能体（重要）

| 智能体 | 优先级 | 状态 | 备注 |
|--------|--------|------|------|
| ChatAgent | P1 | 待开发 | ⭐ 论文对话功能 |
| KeywordAgent | P1 | 待开发 | 提升用户体验 |
| RecommendAgent | P1 | 待开发 | 增强功能 |

### 可选智能体（增强）

| 智能体 | 优先级 | 状态 | 备注 |
|--------|--------|------|------|
| ComparisonAgent | P2 | 待开发 | 高级功能 |

---

## 实施计划

### 第一阶段：核心智能体（1-2周）

1. ✅ 配置 DashScope API Key
2. ✅ 实现 PdfExtractionTool
3. ✅ 实现 SummaryAgent
4. ✅ 实现 InnovationAgent
5. ✅ 实现 MethodologyAgent
6. ✅ 实现 ScoreAgent
7. ✅ 集成到分析服务
8. ✅ 测试和优化

### 第二阶段：辅助智能体（1-2周）

1. ✅ 实现 ChatAgent ⭐（论文对话功能）
   - 创建对话会话表
   - 实现 PaperContentTool
   - 实现 ChatAgent 包装类
   - 集成 MySQL 会话管理
   - 实现流式响应
2. ✅ 实现 KeywordAgent
3. ✅ 实现 RecommendAgent
4. ✅ 集成到系统

### 第三阶段：优化和扩展（持续）

1. ✅ 性能优化
2. ✅ 成本优化
3. ✅ 添加更多智能体（如 ComparisonAgent）

---

## 总结

### 核心智能体（4个）

1. **SummaryAgent**: 生成结构化摘要
2. **InnovationAgent**: 提取创新点
3. **MethodologyAgent**: 分析方法论
4. **ScoreAgent**: 多维度评分

### 辅助智能体（3个）

5. **ChatAgent**: ⭐ 论文智能对话（新增）
6. **KeywordAgent**: 提取关键词
7. **RecommendAgent**: 推荐相关论文

### 工具（3-4个）

1. **PdfExtractionTool**: PDF文本提取
2. **TextPreprocessingTool**: 文本预处理
3. **PaperContentTool**: ⭐ 论文内容访问（对话智能体专用）
4. **DatabaseQueryTool**: 数据库查询（可选）

### 设计特点

- ✅ **模块化**: 每个智能体独立，易于维护
- ✅ **可配置**: 支持灵活的配置管理
- ✅ **可扩展**: 易于添加新的智能体
- ✅ **高性能**: 并行处理，异步执行
- ✅ **成本优化**: 根据任务选择合适的模型

---

**文档维护**: 随着开发进度，持续更新智能体的实际配置和使用经验。
